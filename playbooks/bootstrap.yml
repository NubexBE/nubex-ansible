- hosts: localhost
  become: true

  roles:
    - role: geerlingguy.docker

  post_tasks:
    - name: Ensure Docker service is running
      service:
        name: docker
        state: started
        enabled: true
    - name: Ensure '/srv' exists and has docker group-write, setuid, setgid
      file:
        path: '/srv'
        state: directory
        owner: root
        group: docker
        recurse: true
        mode: g=rwx
    - name: Clone repo into target directory
      git:
        repo: git@github.com:edencehealth/drive_pilot_deployment.git
        accept_newhostkey: true
        dest: /srv/omop
        key_file: /home/ubuntu/.ssh/id_rsa_git # Adjust path as necessary, use full 
